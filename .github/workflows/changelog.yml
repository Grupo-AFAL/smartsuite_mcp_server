name: Changelog

on:
  pull_request:
    branches: [ main ]

jobs:
  check-changelog:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        with:
          fetch-depth: 0 # Need full history to compare

      - name: Check if CHANGELOG was updated
        run: |
          # Skip check if PR has 'skip-changelog' label
          # or if it's from dependabot
          if [[ "${{ github.event.pull_request.user.login }}" == "dependabot[bot]" ]]; then
            echo "✅ Skipping changelog check for Dependabot PR"
            exit 0
          fi

          # Check if CHANGELOG.md was modified
          if git diff --name-only origin/main...HEAD | grep -q "CHANGELOG.md"; then
            echo "✅ CHANGELOG.md was updated"
            exit 0
          else
            echo "❌ CHANGELOG.md must be updated for this PR"
            echo ""
            echo "Please add an entry to CHANGELOG.md under the [Unreleased] section"
            echo "describing your changes."
            echo ""
            echo "If this PR doesn't require a changelog entry (e.g., typo fixes),"
            echo "add the 'skip-changelog' label to bypass this check."
            exit 1
          fi
